# 目标澄清协议 (CLARIFICATION_PROTOCOL) v1.0

## 协议目标

当需要完成较大的目标时，通过"目标澄清讨论"来：
- 明确完整的目标描述
- 细化解决方案
- 生成精确的执行prompt

---

## 触发条件

### 主动触发
- 用户明确说：「需要「使目标更清晰的讨论」」

### 主动判断并询问
- 当 agent 判断"目标并不清晰 or 解法比较复杂"时，主动询问用户是否需要启动讨论

**判断标准（定性描述）：**
- 目标本身宏大但当前信息比较少
- 解法需要多个步骤

*注：小任务（如"发个邮件"）不会触发*

---

## 讨论流程

### 目标层讨论
agent 提出问题，补充目标信息：
- 目标的背景和上下文
- 具体的需求细节
- 预期的结果形式
- 时间约束或优先级

### 解法层讨论
agent 说明初步打算的解法，并询问：
"对于这个目标，你目前打算的解法是 xxx，其中还有哪些需要修改？"

**讨论边界：**
- agent 可以在讨论过程中提出更好的解法
- 用户可以：
  - 中止讨论 → 根据当前讨论结果立刻输出讨论结果、执行prompt
  - 修改目标或解法 → 更新具体内容

### 讨论结束
- 用户确认：「我们可以完成这次讨论了」
- agent 在此之前需要与用户确认，而非自行判断

---

## 输出内容

### 讨论结果（Markdown格式）
- 更完整、清晰的目标描述
- 讨论后的解决方案
- 相关约束和注意事项

**边际情况处理：**
- 对特定任务，若只需讨论目标/解法的其中一个，另一个的输出不需要太详细

### 执行prompt（先展示）
- 基于讨论结果生成信息更完整的prompt
- 用于重新输入给 AI agent 执行任务
- **只做输出展示，不能立即用于执行**

**prompt 要求：**
- 使用 prompt engineering 技巧
- 结构清晰表达讨论得到的目标与解法
- 让模型更好地执行

---

## 版本化规则

### 版本号格式
- 格式：v1.0, v1.1, v2.0
- 升级时机：需要升级时与用户确认

### 版本历史
- 本文件只保留当前版本
- 升级时，将被替换的旧版本内容保存到 `CLARIFICATION_PROTOCOL_HISTORY.md`

### 修改触发
- 用户说：「我们更新一下协议」
- agent 主动建议（发现某个规则反复被打破时）

### 执行prompt标注
执行prompt 需要标注当前协议版本，例如：
> 使用 CLARIFICATION_PROTOCOL v1.0 生成

---

## 讨论结果存储

### 触发条件
每次完成目标澄清讨论后（用户确认"我们可以完成这次讨论了"），自动存储讨论结果。

### 存储流程

#### 1. 自动生成标题
根据讨论内容生成简洁的标题（5-15字）。

#### 2. 创建 Notion 页面
调用 Notion skill 创建页面：
- **标题格式**：`YYYY-MM-DD HH:MM - [自动生成的标题]`
- **内容**：完整讨论结果（目标描述 + 解法说明 + 执行 prompt）
- **属性**：
  - `Date`: 讨论日期
  - `Tags`: 相关标签（根据讨论内容提取）
  - `Protocol`: 当前协议版本（如：v1.0）

#### 3. 发送摘要到 Telegram 群组
发送摘要到「使目标更清晰的讨论」群组（Chat ID: -5079148766）：
```
✅ 讨论结果已保存到 Notion

标题：[自动生成的标题]
时间：YYYY-MM-DD HH:MM
链接：[Notion 链接]

摘要：[目标描述的简要总结]
```

### 配置信息
- **Notion Database ID**: 2f98daf1727c806baa9ce9091760bda4
- **Telegram 群组 ID**: -5079148766
- **Notion Skill 路径**: `/root/clawd/skills/notion`

---

*最后更新：2026-01-31*
*协议版本：v1.0*
